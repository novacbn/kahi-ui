@use "../../../../framework/abstracts/transitions";
@use "../../../../framework/abstracts/variables";

@use "../../../../framework/mixins/intrinsics";
@use "../../../../framework/mixins/palettes";
@use "../../../../framework/mixins/radius";
@use "../../../../framework/mixins/sizings";

@if not env("DISABLE_COMPONENTS_FEEDBACK_PROGRESS") {
    .progress {
        @include palettes.var-neutral-background();
        @include radius.var-reset($namespace: "progress");
        @include sizings.var-reset-size($namespace: "progress", $tier: "icon");

        --value: 0;

        pointer-events: none;
        user-select: none;

        &:empty {
            width: 100%;
            height: calc(var(--sizing-size-icon) * 0.25);

            @include radius.all($unit: rem);

            background-image: linear-gradient(
                to right,
                hsla(
                        var(--palette-background-bolder),
                        #{variables.format-var("progress.indicator.background.opacity")}
                    )
                    50%,
                hsla(
                        var(--palette-background-lightest),
                        #{variables.format-var("progress.track.background.opacity")}
                    )
                    50%
            );
            background-position: calc(100% - var(--value) * 100%) 0%;
            background-size: 200% 100%;

            @include transitions.push($property: background-image, $animation-tier: "visual");
            @include transitions.push($property: background-position, $animation-tier: "movement");

            @include transitions.build();

            &:not([aria-valuenow]) {
                animation: progress-bar-indeterminate 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
        }

        &:not(:empty) {
            & svg {
                @include intrinsics.size-all($sizing-tier: "icon");
            }

            & circle {
                fill: transparent;
                stroke-width: 4px;

                transform: rotate(-90deg);
                transform-origin: 50% 50%;

                @include transitions.push($property: stroke, $animation-tier: "visual");
                @include transitions.push(
                    $property: stroke-dashoffset,
                    $animation-tier: "movement"
                );

                @include transitions.build();
            }

            & circle:first-child {
                stroke: hsla(
                    var(--palette-background-lightest),
                    #{variables.format-var("progress.track.background.opacity")}
                );
            }

            & circle:last-child {
                stroke: hsla(
                    var(--palette-background-bolder),
                    #{variables.format-var("progress.indicator.background.opacity")}
                );
                stroke-dasharray: 88px 88px;
                stroke-dashoffset: calc(88px * (1 - var(--value)));
            }

            &:not([aria-valuenow]) {
                & circle:first-child {
                    stroke: transparent;
                }

                & circle:last-child {
                    animation: progress-circle-indeterminate-indicator
                            3s
                            cubic-bezier(0.4, 0, 0.6, 1)
                            infinite,
                        progress-circle-indeterminate-spin
                            0.75s
                            cubic-bezier(0.4, 0, 0.6, 1)
                            infinite;
                }
            }
        }
    }

    @keyframes progress-bar-indeterminate {
        0% {
            background-position: 100% 0%;
        }

        50% {
            background-position: -100% 0%;
        }

        100% {
            background-position: -100% 0%;
        }
    }

    @keyframes progress-circle-indeterminate-indicator {
        0% {
            stroke-dashoffset: 88px;
        }

        50% {
            stroke-dashoffset: -88px;
        }

        100% {
            stroke-dashoffset: -88px;
        }
    }

    @keyframes progress-circle-indeterminate-spin {
        from {
            transform: rotate(0deg);
        }

        to {
            transform: rotate(360deg);
        }
    }
}
