{
  "version": 3,
  "sources": ["src/stores/svelte.ts"],
  "sourcesContent": ["import * as svelte from \"svelte\";\nimport type {SvelteComponent} from \"svelte\";\nimport type {CompileOptions} from \"svelte/types/compiler/interfaces\";\n\nimport {compile} from \"svelte/compiler\";\nimport * as svelte_internal from \"svelte/internal\";\n\nimport * as svelte_store from \"svelte/store\";\n\nimport type {\n    IPipelineContext,\n    IPipelineError,\n    IPipelineImports,\n    IPipelineModule,\n    IPipelineSuccess,\n    IPipelineStore,\n    IPipelineOptions,\n} from \"./pipeline\";\nimport {PIPELINE_RESULT_TYPES, evaluate_code, make_require, validate_code} from \"./pipeline\";\n\nimport {PIPELINE_JAVASCRIPT_CONTEXT, PIPELINE_JAVASCRIPT_IMPORTS} from \"./javascript\";\n\nconst {\n    onDestroy,\n    onMount,\n    afterUpdate,\n    beforeUpdate,\n    createEventDispatcher,\n    getContext,\n    setContext,\n    tick,\n} = svelte;\n\nconst {derived, readable, writable} = svelte_store;\n\ntype ISvelteExport = {[key: string]: any; default: SvelteComponent};\n\nexport interface IPipelineSvelteModule extends IPipelineModule<ISvelteExport> {}\n\nexport interface IPipelineSvelteOptions extends IPipelineOptions {\n    compiler: CompileOptions;\n}\n\nexport interface IPipelineSvelteSuccess extends IPipelineSuccess<ISvelteExport> {\n    stylesheet: string;\n}\n\nexport interface IPipelineSvelteStore extends IPipelineStore<ISvelteExport> {}\n\nconst PIPELINE_SVELTE_CONTEXT: IPipelineContext = {\n    ...PIPELINE_JAVASCRIPT_CONTEXT,\n    onMount,\n    onDestroy,\n    createEventDispatcher,\n    afterUpdate,\n    beforeUpdate,\n    derived,\n    getContext,\n    readable,\n    setContext,\n    tick,\n    writable,\n};\n\nconst PIPELINE_SVELTE_IMPORTS: IPipelineImports = {\n    ...PIPELINE_JAVASCRIPT_IMPORTS,\n    svelte: svelte,\n    \"svelte/internal\": svelte_internal,\n    \"svelte/store\": svelte_store,\n};\n\n// TODO: meh, repeated code\nfunction PipelineSvelteOptions(\n    options: Partial<IPipelineSvelteOptions> = {}\n): IPipelineSvelteOptions {\n    const {compiler = {}, context = {}, imports = {}} = options;\n    const require = make_require({...PIPELINE_SVELTE_IMPORTS, ...imports});\n\n    return {\n        imports: {},\n        compiler: {\n            ...compiler,\n            format: \"cjs\",\n        },\n\n        context: {\n            ...PIPELINE_SVELTE_CONTEXT,\n            ...context,\n            require,\n        },\n    };\n}\n\nexport function pipeline_svelte(options?: Partial<IPipelineSvelteOptions>): IPipelineSvelteStore {\n    const {compiler, context} = PipelineSvelteOptions(options);\n    const writable_store = writable<string>(\"\");\n\n    const derived_store = derived(writable_store, (script: string) => {\n        if (!script) return null;\n\n        const {css, js} = compile(script, compiler);\n\n        const [validated, message] = validate_code(js.code);\n        if (!validated) return {message, type: PIPELINE_RESULT_TYPES.error} as IPipelineError;\n\n        const module = evaluate_code(js.code, context);\n        return {\n            module,\n            stylesheet: css.code,\n            type: PIPELINE_RESULT_TYPES.success,\n        } as IPipelineSvelteSuccess;\n    });\n\n    return {\n        set: writable_store.set,\n        subscribe: derived_store.subscribe,\n        update: writable_store.update,\n    };\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA,eAAwB;AAIxB,iBAAsB;AACtB,wBAAiC;AAEjC,qBAA8B;AAW9B,iBAAgF;AAEhF,mBAAuE;AAEvE,MAAM;AAAA,EACF;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,IACA;AAEJ,MAAM,CAAC,SAAS,UAAU,YAAY;AAgBtC,MAAM,0BAA4C;AAAA,KAC3C;AAAA,EACH;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA;AAGJ,MAAM,0BAA4C;AAAA,KAC3C;AAAA,EACH;AAAA,EACA,mBAAmB;AAAA,EACnB,gBAAgB;AAAA;AAIpB,+BACI,UAA2C;AAE3C,QAAM,CAAC,sBAAW,IAAI,UAAU,IAAI,UAAU,MAAM;AACpD,QAAM,WAAU,sBAAa,IAAI,4BAA4B;AAE7D,SAAO;AAAA,IACH,SAAS;AAAA,IACT,UAAU;AAAA,SACH;AAAA,MACH,QAAQ;AAAA;AAAA,IAGZ,SAAS;AAAA,SACF;AAAA,SACA;AAAA,MACH;AAAA;AAAA;AAAA;AAKL,yBAAyB;AAC5B,QAAM,CAAC,qBAAU,WAAW,sBAAsB;AAClD,QAAM,iBAAiB,SAAiB;AAExC,QAAM,gBAAgB,QAAQ,gBAAgB,CAAC;AAC3C,QAAI,CAAC;AAAQ,aAAO;AAEpB,UAAM,CAAC,KAAK,MAAM,iBAAQ,QAAQ;AAElC,UAAM,CAAC,WAAW,WAAW,uBAAc,GAAG;AAC9C,QAAI,CAAC;AAAW,aAAO,CAAC,SAAS,MAAM,+BAAsB;AAE7D,UAAM,UAAS,uBAAc,GAAG,MAAM;AACtC,WAAO;AAAA,MACH;AAAA,MACA,YAAY,IAAI;AAAA,MAChB,MAAM,+BAAsB;AAAA;AAAA;AAIpC,SAAO;AAAA,IACH,KAAK,eAAe;AAAA,IACpB,WAAW,cAAc;AAAA,IACzB,QAAQ,eAAe;AAAA;AAAA;",
  "names": []
}
