{
  "version": 3,
  "sources": ["src/stores/javascript.ts"],
  "sourcesContent": ["import {derived, writable} from \"svelte/store\";\n\nimport type {\n    IPipelineContext,\n    IPipelineError,\n    IPipelineImports,\n    IPipelineModule,\n    IPipelineOptions,\n    IPipelineStore,\n    IPipelineSuccess,\n} from \"./pipeline\";\nimport {PIPELINE_RESULT_TYPES, evaluate_code, make_require, validate_code} from \"./pipeline\";\n\ntype IJavascriptExport = {[key: string]: any};\n\nexport interface IPipelineJavascriptModule extends IPipelineModule<IJavascriptExport> {}\n\nexport interface IPipelineJavascriptOptions extends IPipelineOptions {}\n\nexport interface IPipelineJavascriptSuccess extends IPipelineSuccess<IJavascriptExport> {}\n\nexport interface IPipelineJavascriptStore extends IPipelineStore<IJavascriptExport> {}\n\nexport const PIPELINE_JAVASCRIPT_CONTEXT: IPipelineContext = {};\n\nexport const PIPELINE_JAVASCRIPT_IMPORTS: IPipelineImports = {};\n\nfunction PipelineOptions(options: Partial<IPipelineOptions> = {}): IPipelineOptions {\n    const {context = {}, imports = {}} = options;\n    const require = make_require({...PIPELINE_JAVASCRIPT_IMPORTS, ...imports});\n\n    return {\n        imports: {},\n        context: {\n            ...PIPELINE_JAVASCRIPT_CONTEXT,\n            ...context,\n            require,\n        },\n    };\n}\n\nexport function pipeline_javascript(options?: Partial<IPipelineOptions>): IPipelineJavascriptStore {\n    const {context} = PipelineOptions(options);\n    const writable_store = writable<string>(\"\");\n\n    const derived_store = derived(writable_store, (script: string) => {\n        if (!script) return null;\n\n        const [validated, message] = validate_code(script);\n        if (!validated) return {message, type: PIPELINE_RESULT_TYPES.error} as IPipelineError;\n\n        const module = evaluate_code(script, context);\n        return {module, type: PIPELINE_RESULT_TYPES.success} as IPipelineJavascriptSuccess;\n    });\n\n    return {\n        set: writable_store.set,\n        subscribe: derived_store.subscribe,\n        update: writable_store.update,\n    };\n}\n"],
  "mappings": "AAAA;AAWA;AAYO,MAAM,8BAAgD;AAEtD,MAAM,8BAAgD;AAE7D,yBAAyB,UAAqC;AAC1D,QAAM,CAAC,UAAU,IAAI,UAAU,MAAM;AACrC,QAAM,WAAU,aAAa,IAAI,gCAAgC;AAEjE,SAAO;AAAA,IACH,SAAS;AAAA,IACT,SAAS;AAAA,SACF;AAAA,SACA;AAAA,MACH;AAAA;AAAA;AAAA;AAKL,6BAA6B;AAChC,QAAM,CAAC,WAAW,gBAAgB;AAClC,QAAM,iBAAiB,SAAiB;AAExC,QAAM,gBAAgB,QAAQ,gBAAgB,CAAC;AAC3C,QAAI,CAAC;AAAQ,aAAO;AAEpB,UAAM,CAAC,WAAW,WAAW,cAAc;AAC3C,QAAI,CAAC;AAAW,aAAO,CAAC,SAAS,MAAM,sBAAsB;AAE7D,UAAM,SAAS,cAAc,QAAQ;AACrC,WAAO,CAAC,QAAQ,MAAM,sBAAsB;AAAA;AAGhD,SAAO;AAAA,IACH,KAAK,eAAe;AAAA,IACpB,WAAW,cAAc;AAAA,IACzB,QAAQ,eAAe;AAAA;AAAA;",
  "names": []
}
