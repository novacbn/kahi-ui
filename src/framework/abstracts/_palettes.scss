@use "sass:color";
@use "sass:math";

@use "./constants";
@use "./colors";
@use "./strings";

@function generate-palette($background, $foreground, $shading) {
    @return ("background": $background, "foreground": $foreground, "shading": $shading);
}

@mixin each() {
    @include constants.each("palettes.*.background") using ($name, $background) {
        $foreground: constants.get("palettes.#{$name}.foreground");

        @content ($name, $foreground);
    }
}

@function get-shade($background-name, $step, $is-raw: false) {
    $background-color: constants.get("palettes.#{$background-name}.background");
    @if $step == 0 {
        @return colors.normalize-hsl($background-color, $is-raw);
    }

    $shading-name: if($step < 0, "dark", "light");

    $shading-stepping: constants.get("palettes.#{$background-name}.shading");
    $shading-color: constants.get("palettes.#{$shading-name}.background");

    $mixed-color: color.mix($shading-color, $background-color, $shading-stepping * math.abs($step));
    @return colors.normalize-hsl($mixed-color, $is-raw);
}

@function format-reference($key, $face, $shade) {
    // TODO: validate `$face`
    // TODO: validate `$shade`

    @if not has($key) {
        @error "bad argument #1 to 'palettes.format-reference' (invalid key '#{$key}')";
    }

    @return strings.format-identifier("palettes.#{$key}.#{$face}.#{$shade}");
}

@function format-var($key, $face, $shade, $fallback: null) {
    $key: format-reference($key, $face, $shade);

    @if $fallback {
        @return var(#{$key}, #{$fallback});
    }

    @return var(--#{$key});
}
